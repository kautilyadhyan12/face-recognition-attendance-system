{% extends "base.html" %}
{% block content %}
<div class="bg-white p-6 rounded shadow">
  <h2 class="text-2xl font-semibold mb-4">My Attendance History</h2>

  <div class="mb-4">
    <p><strong>Name:</strong> {{ student.name }}</p>
    <p><strong>Roll No:</strong> {{ student.roll }}</p>
    <p><strong>Department:</strong> {{ student.department.name }}</p>
    <p><strong>Subject:</strong> {{ subject.name }}</p>
  </div>

  <form method="GET" class="mb-4 flex flex-wrap gap-3">
    <div>
      <label class="text-sm">Start Date</label><br>
      <input type="date" name="start" value="{{ request.args.get('start','') }}" class="border rounded p-1" />
    </div>
    <div>
      <label class="text-sm">End Date</label><br>
      <input type="date" name="end" value="{{ request.args.get('end','') }}" class="border rounded p-1" />
    </div>
    <button class="bg-blue-600 text-white px-3 py-1 rounded self-end">Filter</button>
    <a href="{{ url_for('student_attendance_history') }}" class="text-sm text-gray-600 self-end ml-2">Reset</a>
  </form>

  {% if records %}
  <table class="w-full border border-gray-300">
    <thead class="bg-gray-200">
      <tr>
        <th class="p-2 border">Date</th>
        <th class="p-2 border">Time</th>
        <th class="p-2 border">Status</th>
        <th class="p-2 border">Confidence</th>
      </tr>
    </thead>
    <tbody>
      {% for r in records %}
      <tr class="text-center">
        <td class="p-2 border">{{ r.class_session.date }}</td>
        <td class="p-2 border">{{ r.timestamp.strftime('%H:%M:%S') }}</td>
        <td class="p-2 border">{{ r.status }}</td>
        <td class="p-2 border">{{ "%.2f"|format(r.confidence or 0.0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-gray-500">No attendance records found for the selected period.</p>
  {% endif %}

  <div class="mt-6">
    <a href="{{ url_for('student_dashboard') }}" class="bg-gray-600 text-white px-4 py-2 rounded">Back to Dashboard</a>
  </div>
</div>
{% endblock %}