{% extends "base.html" %}
{% block content %}
<div class="bg-white p-6 rounded shadow mt-6">
  <h2 class="text-2xl font-semibold mb-4">Student Dashboard</h2>

  <div class="mb-4 border-b pb-4">
    <p><strong>Name:</strong> {{ student.name }}</p>
    <p><strong>Roll No:</strong> {{ student.roll }}</p>
    {% if department %}
      <p><strong>Department:</strong> {{ department.name }}</p>
    {% endif %}
    {% if subject %}
      <p><strong>Subject:</strong> {{ subject.name }}</p>
    {% else %}
      <p class="text-red-500">No subject assigned yet.</p>
    {% endif %}
  </div>

  {% if subject %}
  <div class="mb-6">
    <h3 class="text-lg font-semibold mb-2">Attendance Summary</h3>
    <p><strong>Total Classes Conducted:</strong> {{ total_classes }}</p>
    <p><strong>Classes Attended:</strong> {{ marked }}</p>
    <p><strong>Attendance Percentage:</strong> 
      <span {% if perc < 75 %} class="text-red-600 font-semibold" {% else %} class="text-green-600 font-semibold" {% endif %}>
        {{ '%.2f'|format(perc) }}%
      </span>
    </p>
    <p><strong>Status:</strong>
      {% if eligible %}
        <span class="text-green-600 font-semibold">Eligible for Exam </span>
      {% else %}
        <span class="text-red-600 font-semibold">Not Eligible (Below 75%) </span>
      {% endif %}
    </p>
  </div>

  <div class="my-6">
    <h3 class="text-lg font-semibold mb-2"> Attendance Over Time</h3>
    <canvas id="attendanceChart" height="100"></canvas>
  </div>

  <div class="mt-6 flex flex-wrap gap-3">
    <a href="{{ url_for('student_attendance_history') }}" 
       class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
       View Detailed Attendance
    </a>
    <a href="{{ url_for('download_student_attendance_pdf') }}" 
       class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
       Download PDF
    </a>
    <a href="{{ url_for('student_logout') }}" 
       class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition">
       Logout
    </a>
  </div>
  {% endif %}
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ chart_labels|tojson }};
  const data = {
    labels: labels,
    datasets: [{
      label: 'Classes Attended',
      data: {{ chart_values|tojson }},
      borderColor: 'rgba(54, 162, 235, 1)',
      backgroundColor: 'rgba(54, 162, 235, 0.2)',
      tension: 0.3,
      fill: true,
    }]
  };
  const config = {
    type: 'line',
    data: data,
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: 'Attendance Over Time' }
      },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Classes Attended' } },
        x: { title: { display: true, text: 'Date' } }
      }
    }
  };
  new Chart(document.getElementById('attendanceChart'), config);
</script>
{% endblock %}
